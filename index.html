<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon GO Level 50 XP Calculator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for a subtle background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0);
            background-size: 20px 20px;
            opacity: 0.5;
            z-index: -1;
        }
        /* Custom focus ring color */
        .focus-ring-poke-blue:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity));
            box-shadow: 0 0 0 3px rgb(59 130 246 / 0.5);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen p-4">
    
    <div class="w-full max-w-lg">
        <!-- Main Calculator Card -->
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-slate-200">
            <div class="text-center mb-6">
                <!-- Header with a simple icon -->
                <div class="flex justify-center items-center mb-3">
                     <!-- *** NEW: SVG Pokeball Logo *** -->
                     <svg viewBox="0 0 100 100" class="w-24 h-24">
                        <defs>
                            <clipPath id="top-half">
                                <rect x="0" y="0" width="100" height="50" />
                            </clipPath>
                            <clipPath id="bottom-half">
                                <rect x="0" y="50" width="100" height="50" />
                            </clipPath>
                        </defs>
                        <circle cx="50" cy="50" r="48" fill="none" stroke="black" stroke-width="4" />
                        <circle cx="50" cy="50" r="48" fill="#ef4444" clip-path="url(#top-half)" />
                        <circle cx="50" cy="50" r="48" fill="white" clip-path="url(#bottom-half)" />
                        <line x1="2" y1="50" x2="98" y2="50" stroke="black" stroke-width="5" />
                        <circle cx="50" cy="50" r="18" fill="white" stroke="black" stroke-width="5" />
                        <circle cx="50" cy="50" r="10" fill="white" stroke="#a1a1aa" stroke-width="2" />
                    </svg>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold text-slate-900">Level 50 XP Calculator</h1>
                <p class="text-slate-500 mt-1">For Pokémon GO</p>
            </div>

            <!-- Input Form -->
            <form id="xp-form" class="space-y-4">
                <div>
                    <label for="current-level" class="block text-sm font-medium text-slate-600 mb-1">Your Current Level</label>
                    <select id="current-level" class="w-full px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus-ring-poke-blue transition">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>

                <div>
                    <label for="current-xp" class="block text-sm font-medium text-slate-600 mb-1">Current XP for this Level</label>
                    <input type="text" id="current-xp" placeholder="e.g., 1,500,000" class="w-full px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus-ring-poke-blue transition">
                </div>

                <div class="flex items-center justify-center pt-2">
                    <input id="lucky-egg-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <label for="lucky-egg-checkbox" class="ml-2 block text-sm text-slate-600">
                        Use a Lucky Egg for the 7M research bonus?
                    </label>
                </div>


                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus-ring-poke-blue">
                    Calculate
                </button>
            </form>
            
            <div id="message-box" class="hidden mt-4 p-3 text-center text-sm rounded-lg"></div>

            <!-- Results Section -->
            <div id="results" class="hidden mt-6 pt-6 border-t border-slate-200 space-y-4">
                <div class="bg-indigo-50 p-4 rounded-lg text-center">
                    <p class="text-sm font-medium text-indigo-600">Total XP Needed for Level 50</p>
                    <p id="remaining-xp" class="text-3xl font-bold text-indigo-800">0</p>
                </div>
                <div class="bg-amber-50 p-4 rounded-lg text-center">
                    <p class="text-sm font-medium text-amber-600">Average XP/day until Oct 14, 2025</p>
                    <p id="xp-per-day" class="text-3xl font-bold text-amber-800">0</p>
                </div>
                <p id="bonus-xp-note" class="hidden text-xs text-slate-500 text-center italic pt-2">
                    Daily XP goal is reduced by 14,000,000 XP (7M research + Lucky Egg).
                </p>
            </div>
        </div>

        <!-- Level Requirements Section -->
        <div id="level-requirements-container" class="mt-8 space-y-4">
            <!-- Requirements will be populated by JavaScript -->
        </div>
        
        <!-- View Counter -->
        <div id="view-counter" class="mt-6 text-center text-xs text-slate-400 flex items-center justify-center space-x-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span id="view-count-number">...</span>
            <span>views</span>
        </div>
    </div>

    <!-- Firebase Libraries -->
    <script type="module">
        // IMPORTANT: These scripts are required for Firebase to work.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, runTransaction, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async () => {
            // --- FIREBASE SETUP ---
            let db, auth;
            try {
                // These global variables are provided by the environment.
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug');

                // Authenticate the user
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Initialize and update the view counter
                await setupViewCounter(db, appId);

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                const viewCountEl = document.getElementById('view-count-number');
                if(viewCountEl) viewCountEl.textContent = 'N/A';
            }
            
            // --- VIEW COUNTER LOGIC ---
            async function setupViewCounter(db, appId) {
                const viewCountEl = document.getElementById('view-count-number');
                const counterDocRef = doc(db, `artifacts/${appId}/public/data/viewcounts`, "counter");

                try {
                    // Use a transaction to safely increment the counter
                    await runTransaction(db, async (transaction) => {
                        const counterDoc = await transaction.get(counterDocRef);
                        if (!counterDoc.exists()) {
                            transaction.set(counterDocRef, { count: 1 });
                        } else {
                            const newCount = counterDoc.data().count + 1;
                            transaction.update(counterDocRef, { count: newCount });
                        }
                    });

                    // Listen for real-time updates to the counter
                    onSnapshot(counterDocRef, (doc) => {
                        if (doc.exists()) {
                            viewCountEl.textContent = doc.data().count.toLocaleString();
                        } else {
                            viewCountEl.textContent = '1';
                        }
                    });

                } catch (e) {
                    console.error("Transaction failed: ", e);
                    viewCountEl.textContent = 'Error';
                }
            }


            // --- CALCULATOR LOGIC (from previous steps) ---
            const cumulativeXpByLevel = [0, 1000, 3000, 6000, 10000, 15000, 21000, 28000, 36000, 45000, 55000, 65000, 75000, 85000, 100000, 120000, 140000, 160000, 185000, 210000, 260000, 335000, 435000, 560000, 710000, 900000, 1100000, 1350000, 1650000, 2000000, 2500000, 3000000, 3750000, 4750000, 6000000, 7500000, 9500000, 12000000, 15000000, 20000000, 26000000, 33500000, 42500000, 53500000, 66500000, 82000000, 100000000, 121000000, 146000000];
            const LEVEL_50_TOTAL_XP = 176000000;
            const RESEARCH_BONUS_XP = 7000000;
            const levelUpData = {
                41: { xp: "6,000,000", tasks: ["Power up a Legendary Pokémon 20 times", "Win 30 Raids", "Catch 200 Pokémon in a single day", "Earn 5 Gold Medals"], rewards: ["20 Ultra Balls", "20 Max Potions", "20 Max Revives", "20 Razz Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy"] },
                42: { xp: "7,500,000", tasks: ["Evolve Eevee into each of its unique evolutions", "Use items to evolve Pokémon 15 times", "Make 3 Excellent Throws", "Use 200 Berries to help catch Pokémon"], rewards: ["20 Ultra Balls", "20 Max Potions", "20 Max Revives", "20 Nanab Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy"] },
                43: { xp: "9,000,000", tasks: ["Earn 100,000 Stardust", "Use 200 supereffective Charged Attacks", "Catch 5 Legendary Pokémon", "Earn 5 Platinum Medals"], rewards: ["20 Ultra Balls", "20 Max Potions", "20 Max Revives", "20 Silver Pinap Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy", "Avatar Pose"] },
                44: { xp: "11,000,000", tasks: ["Win 30 Trainer Battles in the Great League", "Win 30 Trainer Battles in the Ultra League", "Win 30 Trainer Battles in the Master League", "Battle in the Go Battle League 20 times"], rewards: ["20 Ultra Balls", "20 Max Potions", "20 Max Revives", "20 Razz Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy"] },
                45: { xp: "13,000,000", tasks: ["Defeat 100 Team Go Rocket Grunts", "Purify 100 Shadow Pokémon", "Defeat a Team Go Rocket Leader 50 times", "Earn 10 Platinum Medals"], rewards: ["40 Ultra Balls", "40 Max Revives", "1 Elite Fast TM", "2 Rare XL Candy", "2 Incense", "2 Lucky Eggs", "1 Super Incubator", "2 Lure Modules", "Level 45 Hat Avatar Item"] },
                46: { xp: "15,500,000", tasks: ["Complete 100 Field Research tasks", "Take a snapshot of a Pokémon 7 days in a row", "Make 50 Excellent Throws", "Hatch 30 Eggs"], rewards: ["30 Ultra Balls", "25 Max Potions", "20 Max Revives", "25 Razz Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy"] },
                47: { xp: "18,000,000", tasks: ["Win 30 raids using a team of unique Pokémon species", "Win a 3-star raid using only Pokémon with 1,500 CP or less", "Power up 3 Pokémon to their max CP", "Earn 20 Platinum Medals"], rewards: ["30 Ultra Balls", "25 Max Potions", "20 Max Revives", "25 Nanab Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy", "Avatar Pose"] },
                48: { xp: "21,000,000", tasks: ["Receive 20 Souvenirs from your Buddy", "Earn 300 hearts with your Buddy", "Walk 200km with your Buddy", "Walk 25km in a week 2 times"], rewards: ["30 Ultra Balls", "25 Max Potions", "20 Max Revives", "15 Silver Pinap Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy"] },
                49: { xp: "25,000,000", tasks: ["Make 10 trades with Pokémon caught at least 300km apart", "Obtain 50 Lucky Pokémon in trades", "Send 500 gifts to friends", "Earn 35 Platinum Medals"], rewards: ["30 Ultra Balls", "25 Max Potions", "20 Max Revives", "25 Pinap Berries", "1 Incubator", "1 Premium Raid Pass", "1 Rare XL Candy", "Level 49 Boots Avatar Item"] },
                50: { xp: "30,000,000", tasks: ["Make 999 Excellent Throws", "Catch a Legendary Pokémon in your next 5 Legendary encounters", "Defeat a Team GO Rocket Leader 3 times using only Pokémon with 2,500 CP or less", "Reach Rank 10 in the Go Battle League"], rewards: ["50 Ultra Balls", "50 Max Potions", "1 Elite Charged TM", "2 Rare XL Candy", "5 Incense", "5 Lucky Eggs", "5 Super Incubators", "5 Lure Modules", "Level 50 Jacket Avatar Item"] }
            };
            const levelSelect = document.getElementById('current-level');
            const xpInput = document.getElementById('current-xp');
            const form = document.getElementById('xp-form');
            const resultsDiv = document.getElementById('results');
            const remainingXpEl = document.getElementById('remaining-xp');
            const xpPerDayEl = document.getElementById('xp-per-day');
            const messageBox = document.getElementById('message-box');
            const requirementsContainer = document.getElementById('level-requirements-container');
            const luckyEggCheckbox = document.getElementById('lucky-egg-checkbox');
            const bonusXpNote = document.getElementById('bonus-xp-note');
            const calculateButton = document.querySelector('#xp-form button[type="submit"]');
            let hasCalculatedOnce = false;
            for (let i = 1; i < 50; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Level ${i}`;
                levelSelect.appendChild(option);
            }
            displayLevelRequirements(0);
            function showMessage(message, type = 'error') {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-blue-100', 'text-blue-700');
                messageBox.classList.add(type === 'error' ? 'bg-red-100' : 'bg-blue-100', type === 'error' ? 'text-red-700' : 'text-blue-700');
                messageBox.classList.remove('hidden');
            }
            function hideMessage() { messageBox.classList.add('hidden'); }
            function displayLevelRequirements(selectedLevel) {
                requirementsContainer.innerHTML = '';
                if (selectedLevel < 40) return;
                let hasShownHeader = false;
                for (let level = 41; level <= 50; level++) {
                    if (level > selectedLevel) {
                        if (!hasShownHeader) {
                            const header = document.createElement('h2');
                            header.className = "text-xl font-bold text-slate-800 text-center";
                            header.textContent = "Your Road to Level 50";
                            requirementsContainer.appendChild(header);
                            hasShownHeader = true;
                        }
                        const data = levelUpData[level];
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl shadow-lg p-5 border border-slate-200';
                        card.innerHTML = `<h3 class="text-lg font-bold text-slate-900">Level ${level}</h3><p class="text-sm text-slate-500 mb-4">Requires ${data.xp} XP</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"><div><h4 class="font-semibold text-slate-700 mb-2">Challenges</h4><ul class="list-disc list-inside space-y-1 text-slate-600">${data.tasks.map(task => `<li>${task}</li>`).join('')}</ul></div><div><h4 class="font-semibold text-slate-700 mb-2">Rewards</h4><ul class="list-disc list-inside space-y-1 text-slate-600">${data.rewards.map(reward => `<li>${reward}</li>`).join('')}</ul></div></div>`;
                        requirementsContainer.appendChild(card);
                    }
                }
            }
            function calculateXP(e) {
                e.preventDefault();
                hideMessage();
                const currentLevel = parseInt(levelSelect.value, 10);
                const xpString = xpInput.value.replace(/,/g, '');
                const currentXpForLevel = parseInt(xpString, 10) || 0;
                const baseXP = cumulativeXpByLevel[currentLevel - 1];
                const totalUserXp = baseXP + currentXpForLevel;
                const trueRemainingXp = LEVEL_50_TOTAL_XP - totalUserXp;
                if (trueRemainingXp <= 0) {
                    showMessage("Congratulations! You've already reached Level 50 or surpassed the required XP!", "info");
                    resultsDiv.classList.add('hidden');
                    requirementsContainer.innerHTML = '';
                    return;
                }
                remainingXpEl.textContent = trueRemainingXp.toLocaleString();
                const useLuckyEggBonus = luckyEggCheckbox.checked;
                const bonusXp = useLuckyEggBonus ? RESEARCH_BONUS_XP * 2 : 0;
                const remainingXpForDailyCalc = trueRemainingXp - bonusXp;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const targetDate = new Date('2025-10-14T00:00:00');
                const timeDifference = targetDate.getTime() - today.getTime();
                const daysLeft = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));
                let xpPerDay = 0;
                if (remainingXpForDailyCalc <= 0) {
                    xpPerDay = 0;
                } else if (daysLeft > 0) {
                    xpPerDay = Math.ceil(remainingXpForDailyCalc / daysLeft);
                } else {
                    xpPerDay = remainingXpForDailyCalc;
                }
                xpPerDayEl.textContent = xpPerDay.toLocaleString();
                resultsDiv.classList.remove('hidden');
                if (useLuckyEggBonus) {
                    bonusXpNote.classList.remove('hidden');
                } else {
                    bonusXpNote.classList.add('hidden');
                }
                displayLevelRequirements(currentLevel);
                hasCalculatedOnce = true;
            }
            function updateButtonText() { if (hasCalculatedOnce) { calculateButton.textContent = 'Re-calculate'; } }
            form.addEventListener('submit', calculateXP);
            levelSelect.addEventListener('change', () => {
                const currentLevel = parseInt(levelSelect.value, 10);
                displayLevelRequirements(currentLevel);
                updateButtonText();
            });
            xpInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/[^0-9]/g, '');
                if (value) {
                    e.target.value = parseInt(value, 10).toLocaleString('en-US');
                } else {
                    e.target.value = '';
                }
                updateButtonText();
            });
            luckyEggCheckbox.addEventListener('change', updateButtonText);
        });
    </script>
</body>
</html>
